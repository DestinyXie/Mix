var HEAD,BODY,DOC=document,WIN=window;WIN.Load=WIN.Load||[];var isTouch="ontouchstart"in WIN,START_EVENT=isTouch?"touchstart":"mousedown",MOVE_EVENT=isTouch?"touchmove":"mousemove",END_EVENT=isTouch?"touchend":"mouseup",CLICK_EVENT=isTouch?"touchend":"click",Load=WIN.Load||[];Load.push(function(){HEAD=$("head");BODY=DOC.body});function extend(a,b){for(p in b)b[p]!==null&&(a[p]=typeof b[p]=="object"&&!b[p].nodeType&&!(b[p]instanceof Array)?extend({},b[p]):b[p]);return a}
Array.prototype.has=function(a){return this.indexOf(a)!==-1};_$=DOC.querySelectorAll?function(a,b){return b.querySelectorAll(a)}:function(){alert("Selector not implemented")};$$=function(a,b){b=b||DOC;return _$(a,b)};$=function(a,b){var c=$$(a,b);return c.length>0?c[0]:null};$.each=function(a,b){a.nodeType&&(a=[a]);for(var c=a.length;c--;)b(a[c],c)};
var Event=function(a){if(!a)return null;this.event=a;for(var b=a.changedTouches,a=b&&b.length>0?b[0]:a,b=["pageX","pageY","target"],c=b.length;c--;)this[b[c]]=a[b[c]]};Event.prototype={stop:function(){if(e=this.event)e.preventDefault(),e.stopPropagation()},getTargets:function(a){var b=[],c=this.target;[DOC,BODY].has(c)||(b=DOM.findParent(c,a),1==c.nodeType&&b.unshift(c));return b}};
var DOM={create:function(a,b){var c=DOC.createElement(a);if(b){if(b.style)DOM.setStyles(c,b.style),b.style=null;extend(c,b)}return c},remove:function(a){a.parentNode.removeChild(a)},findParent:function(a,b,c){var f=[];if(b)for(var b=$$(b),g=[],j=b.length;j--;)g.push(b[j]);for(;a=a.parentNode;){if([DOC,BODY].has(a))break;if(1==a.nodeType&&(!g||g&&g.has(a))){if(c)return a;f.push(a)}}return f},setStyles:function(a,b){var c,f;for(f in b){c=b[f];c!==""&&!isNaN(c)&&f!=="zoom"&&(c+="px");try{a.style[f]=
c}catch(g){}}},hasClass:function(a,b){return a.className.split(/\s+/).has(b)},addClass:function(a,b){$.each(a,function(c){var f=c.className;DOM.hasClass(a,b)||(c.className+=(f?" ":"")+b)})},dropClass:function(a,b){$.each(a,function(a){var f=a.className.split(/\s+/);b&&f.has(b)&&f.splice(f.indexOf(b),1);a.className=f.join(" ")})},contains:function(a,b){for(;b;){if(b==a)return!0;b=b.parentNode}return!1},addEvent:DOC.addEventListener?function(a,b,c,f){var g=function(b){c.call(a,new Event(b))};!f&&a==
DOC&&b in Delegate?Delegate[b].push(g):a.addEventListener(b,g,!1)}:function(a,b,c){a.attachEvent("on"+b,c)},removeEvent:DOC.addEventListener?function(a,b,c){a.removeEventListener(b,function(b){c.call(a,new Event(b))},!1)}:function(a,b,c){a.detachEvent("on"+b,c)}},Delegate={init:function(){var a={start:START_EVENT,end:END_EVENT,onclick:"click"};for(type in a)Delegate[a[type]]=[],DOM.addEvent(DOC,a[type],Delegate[type],!0);Delegate[CLICK_EVENT]=[]},start:function(a){Delegate.startEvent&&Delegate.end(a);
DOC.addEventListener(MOVE_EVENT,Delegate.move,!1);Delegate.startEvent=a;Delegate.isClick=!0;Delegate.startPoint=[a.pageX,a.pageY];Delegate.targets=[];for(var b=a.getTargets(),c=b.length,f;c--;)if(f=b[c],f.getAttribute("_click")||["A","INPUT"].has(f.nodeName)){DOM.addClass(f,"active");Delegate.targets.push(f);break}b=Delegate[START_EVENT];for(c=b.length;c--;)b[c].call(null,a)},onclick:function(a){a.getTargets().forEach(function(b){b.getAttribute("_click")&&a.stop()})},move:function(a){if(Delegate.startEvent){var b=
Delegate.startPoint,a=[a.pageX,a.pageY];if(Tools.calculPy(a[0]-b[0],a[1]-b[1])>6)Delegate.isClick=!1}},end:function(a){a.stop();var b=Delegate.targets;if(b){b.forEach(function(a){DOM.dropClass(a,"active")});if(Delegate.isClick){for(var c,f=b.length;f--;)c=b[f],c.event=a,(evt=c.getAttribute("_click"))&&(new Function(evt)).call(c);b=Delegate[CLICK_EVENT];for(f=b.length;f--;)b[f].call(null,a)}b=Delegate[END_EVENT];for(f=b.length;f--;)b[f].call(null,a)}DOC.removeEventListener(MOVE_EVENT,Delegate.move,
!1);Delegate.isClick=!1;Delegate.startEvent=null;Delegate.startPoint=[0,0];Delegate.targets=[]}};Delegate.init();
var Tools={calculPy:function(a,b){return Math.pow(Math.pow(a,2)+Math.pow(b,2),0.5)},checkLogin:function(a,b){var c="http://localhost/friend/v3/";/m.kxjy.com/.test(location.href)&&(c="http://m.kxjy.com/");zy_$.ajax({url:c+"userLogin.php",type:"get",dataType:"json",data:"email="+($(a).value||"asdf@1qq.com")+"&password="+($(b).value||"asdf"),success:function(a){a.error?toast("\u51fa\u9519\u4e86:"+a.msg):(toast(a.redirect.replace(/.*\?/,"")),location.href=c+"template/mobile/mainPhoto.html?"+a.redirect.replace(/.*\?/,
""))},error:function(){alert("wrong")}})},getSid:function(){var a=location.href,b=/\?.*$/.exec(a)[0],a=a.replace(b,""),a=b.split("&"),c="";$.each(a,function(a){var b=/[^\w]sid=(\w*)/;b.test(a)&&(c=b.exec(a)[1])});if(c!="")return c;return!1},insertAtCaret:function(a,b){var c=a.nodeType==1?a:$(a);if(document.all&&c.createTextRange&&c.caretPos)c=c.caretPos,c.text=c.text.charAt(c.text.length-1)==""?b+"":b;else if(c.setSelectionRange){var f=c.selectionStart,g=c.selectionEnd,j=c.value.substring(0,f),g=
c.value.substring(g);c.value=j+b+g;c.focus();j=b.length;c.setSelectionRange(f+j,f+j);c.focus()}else c.value+=b}};function pageInit(){if(Load){for(var a=0,b=Load.length;a<b;a++)Load[a]();Load=null}}window.uexOnload=isTouch?pageInit:null;window.onload=isTouch?function(){Load&&pageInit()}:pageInit;var feedTemplate={photo:'<div _click="openWindowS(\'hisPhoto.html?${href}\')" class="mainList ub-img1"><img src="${src}" alt="xx" /></div>',mood:'<div class="DynamicList clearfix">        <div class="DynamicInfo">            <div _click="openWindowS(\'hisPhoto.html?${userPage}\')" class="DynamicAvatar"><img src="${avatar}" alt="xx" /></div>            <div class="DynamicAvatar-r">                <strong _click="openWindowS(\'hisPhoto.html?${userPage}\')" class="DynamicName">${nickName}</strong>                <span class="DynamicTrank"><img src="${flower}" alt="xx" /></span>                <ul class="DynamicNav clearfix">                    <li><span class="DynamicIco ub-img1 time"></span>${time}</li>                    <li><span class="DynamicIco ub-img1 place"></span>${address}</li>                </ul>            </div>        </div>        <div class="DynamicMoodBox ub">            <div class="DynamicMood"><img src="${moodIcon}" alt="xx" /></div>            <div class="ub-f1 DynamicMoodText">                <span>&diams;</span>                <div class="DynamicText ub">                    <p class="ub-f1">${mood}</p>                    <strong class="DynamicMore">></strong>                </div>                <div class="DynamicImg"><img src="${moodPic}" alt="xx" /></div>            </div>        </div>        <ul class="DynamicMenu clearfix">            <li class="btnBg active"><span class="DynamicMenuIco love"></span>\u559c\u6b22(22)</li>            <li class="btnBg"><span class="DynamicMenuIco comment"></span>\u8bc4\u8bba(22)</li>            <li class="btnBg"><span class="DynamicMenuIco Report"></span>\u4e3e\u62a5(22)</li>            <li class="btnBg"><span class="DynamicMenuIco"></span>\u5206\u4eab${index:}</li>        </ul>    </div>',
myMood:'<div class="DynamicList clearfix">        <div class="dockEl">                <ul class="DynamicNav clearfix">                    <li><span class="DynamicIco ub-img1 time"></span><label>${time}</label></li>                    <li><span class="DynamicIco ub-img1 place"></span><label>${address}</label></li>                </ul>        </div>        <\!--\u56fe\u7247\u6309\u94ae\u5f00\u59cb--\>        <div class="DynamicMoodBox ub ub-ac ui-btn-icon-right">            <div class="DynamicMood ub-img1" style="background:url(${moodIcon})"></div>            <div class="ub-f1 ut-s DynamicMoodText">${mood}</div>            <div class="res8 lis-sw ub-img1"></div>        </div>        <div class="DynamicImg ub-img1"><img src="${moodPic}" alt=""></div>        <ul class="DynamicMenu clearfix">            <li><span class="DynamicIco ub-img1 love"></span>\u559c\u6b22</li>            <li><span class="DynamicIco ub-img1 comment"></span>\u8bc4\u8bba</li>            <li><span class="DynamicIco ub-img1 Report"></span>\u4e3e\u62a5</li>            <li><span class="DynamicIco ub-img1 "></span>\u5206\u4eab</li>        </ul>        <\!--\u56fe\u7247\u6309\u94ae\u7ed3\u675f--\>    </div>',
chatList:'<div class="commentList ub ub-ac clearfix">        <div class="commentListAvatar"><img src="${avatar}" alt="\u5934\u50cf" /></div>        <div class="commentListText ub-f1">            <p class="chatListName">\u7528\u6237\u6635\u79f0${index:}</p>            <p class=" ut-s">\u79c1\u4fe1\u5185\u5bb9</p>        </div>        <strong class="DynamicMore" _click="openWindowS(\'chat.html?${userPage}\')">></strong>    </div>',chat:'<div class="chatContent ub ${cb:} clearfix">        <div class="chatAvatar"><img src="${avatar}" alt="xx" /></div>        <div class="chatTextBox ub-f1">            <div class="chatTime">2012-6-7 17-${index:}</div>            <div class="chatText">${chatCon}</div>            <span>&diams;</span>        </div>    </div>'},
pageFeed={mainPhoto:"photo",mainList:"mood",myPhoto:"photo",myList:"myMood",newGuest:"photo",likeMe:"photo",attract:"photo",myView:"photo",blackList:"photo",likeMood:"mood",likePerson:"photo",chatList:"chatList",chat:"chat"},Feed={index:0,cont:null,more:null,oneTimeLen:5,moreTxt:"\u67e5\u770b\u66f4\u591a",noMoreTxt:"\u6ca1\u6709\u66f4\u591a\u4e86",init:function(a,b,c,f,g){this.page=a;this.cont=$(b);this.more=c?$(c):!1;this.cb=f;this.lastPos=g},loadMore:function(a){function b(){Feed.more&&(Feed.more.innerHTML=
Feed.moreTxt);if(a)Feed.cont.innerHTML="";for(var b=0,k=Feed.oneTimeLen;b<k;b++){c=DOM.create("div");c.innerHTML=Feed.page=="chat"?zy_tmpl_s(j,f[Feed.index],function(a){if(a.id=="0")return" chatContent-r ub-rev"},Feed.index+1):zy_tmpl_s(j,f[Feed.index],null,Feed.index+1);if(Feed.lastPos){var l=Feed.cont.childNodes;Feed.cont.insertBefore(c.childNodes[0],l[l.length-1-Feed.lastPos])}else Feed.cont.appendChild(c.childNodes[0]);Feed.index++;delete c;if(Feed.index>=g){Feed.more&&(Feed.more.innerHTML=Feed.noMoreTxt);
break}}typeof Feed.cb=="function"&&Feed.cb()}var c,f=fakeJsonData[this.page],g=f.length,j=feedTemplate[pageFeed[this.page]];if(this.index>=g)return!1;if(!a)Feed.more&&(Feed.more.innerHTML="\u6b63\u5728\u52a0\u8f7d...");setTimeout(function(){b()},1E3)},refresh:function(){this.index=0;this.loadMore(!0)},share:function(){}},Comment={moodInter:null,motions:["@1","@2","@3","@4","@5","@6","@7","@8","@9","@10","@11","@12","@13","@14","@15","@16","@17","@18","@19","@20","@21","@22","@11","@12","@13","@14",
"@15","@16","@17","@18","@19","@20","@21","@22","@20","@21","@22","@11","@12","@13","@14","@15","@16","@17","@18","@19","@20","@21","@22"],init:function(a){this.commBox=$(a);this.moodImg=$(".enterMood",Comment.commBox);this.moodBox=$(".chatMood",Comment.commBox);this.input=$(".enterInput input",Comment.commBox);this.sentBtn=$(".enterButton",Comment.commBox);this.bindEvent()},bindEvent:function(){DOM.addEvent(Comment.moodImg,CLICK_EVENT,function(a){Comment.moodBox.style.display!="block"?Comment.showMoodBox():
Comment.hideMoodBox();a.stop()});DOM.addEvent(Comment.input,CLICK_EVENT,function(a){Comment.hideMoodBox();a.stop()});DOM.addEvent(Comment.moodBox,START_EVENT,function(a){a.stop()});DOM.addEvent(Comment.moodBox,CLICK_EVENT,function(a){for(var a=a.getTargets("li")[0],b=$$("li",Comment.moodBox),c=b.length,f=[],g=0;g<c;g++)f[g]=b[g];a=f.indexOf(a);typeof a=="number"&&a>=0&&Tools.insertAtCaret(Comment.input,Comment.motions[a])});DOM.addEvent(DOC,CLICK_EVENT,function(){Comment.hideMoodBox()});DOM.addEvent(Comment.sentBtn,
CLICK_EVENT,function(){toast("\u53d1\u8868:"+Comment.input.value)})},showMoodBox:function(){if(Comment.moodBox.style.display=="none")clearTimeout(Comment.moodInter),Comment.moodBox.style.display="block",this.moodInter=setTimeout(function(){DOM.addClass(Comment.moodBox,"display")},0)},hideMoodBox:function(){if(Comment.moodBox.style.display!="none")clearTimeout(Comment.moodInter),DOM.dropClass(Comment.moodBox,"display"),this.moodInter=setTimeout(function(){Comment.moodBox.style.display="none"},250)}},
fakeJsonData={mainPhoto:[{href:"#1",src:"css/images/mainListImg.gif"},{href:"#2",src:"css/images/mainListImg.gif"},{href:"#3",src:"css/images/mainListImg.gif"},{href:"#4",src:"css/images/mainListImg.gif"},{href:"#5",src:"css/images/mainListImg.gif"},{href:"#6",src:"css/images/mainListImg.gif"},{href:"#7",src:"css/images/mainListImg.gif"},{href:"#8",src:"css/images/mainListImg.gif"},{href:"#9",src:"css/images/mainListImg.gif"},{href:"#10",src:"css/images/mainListImg.gif"},{href:"#11",src:"css/images/mainListImg.gif"},
{href:"#12",src:"css/images/mainListImg.gif"}],mainList:[{avatar:"css/images/avatar.jpg",nickName:"\u7528\u6237#1",userPage:"#1",flower:"css/images/flowers.png",time:"10:20",address:"\u4e0a\u6d77 \u666e\u9640",moodIcon:"css/images/f_1.png",mood:"\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u54e5",
moodPic:"css/images/mainImg.gif"},{avatar:"css/images/avatar.jpg",nickName:"\u7528\u6237#2",userPage:"#2",flower:"css/images/flowers.png",time:"10:20",address:"\u4e0a\u6d77 \u666e\u9640",moodIcon:"css/images/f_1.png",mood:"\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u54e5",
moodPic:"css/images/mainImg.gif"},{avatar:"css/images/avatar.jpg",nickName:"\u7528\u6237#3",userPage:"#3",flower:"css/images/flowers.png",time:"10:20",address:"\u4e0a\u6d77",moodIcon:"css/images/f_1.png",mood:"\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u54e5",
moodPic:"css/images/mainImg.gif"},{avatar:"css/images/avatar.jpg",nickName:"\u7528\u6237#4",userPage:"#4",flower:"css/images/flowers.png",time:"10:20",address:"\u4e0a\u6d77 \u666e\u9640",moodIcon:"css/images/f_1.png",mood:"\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u54e5",
moodPic:"css/images/mainImg.gif"},{avatar:"css/images/avatar.jpg",nickName:"\u7528\u6237#5",userPage:"#5",flower:"css/images/flowers.png",time:"10:20",address:"\u4e0a\u6d77 \u666e\u9640",moodIcon:"css/images/f_1.png",mood:"\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u54e5",
moodPic:"css/images/mainImg.gif"},{avatar:"css/images/avatar.jpg",nickName:"\u7528\u6237#6",userPage:"#6",flower:"css/images/flowers.png",time:"10:20",address:"\u4e0a\u6d77 \u666e\u9640",moodIcon:"css/images/f_1.png",mood:"\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u54e5",
moodPic:"css/images/mainImg.gif"},{avatar:"css/images/avatar.jpg",nickName:"\u7528\u6237#7",userPage:"#7",flower:"css/images/flowers.png",time:"10:20",address:"\u4e0a\u6d77",moodIcon:"css/images/f_1.png",mood:"\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u54e5",
moodPic:"css/images/mainImg.gif"},{avatar:"css/images/avatar.jpg",nickName:"\u7528\u6237#8",userPage:"#8",flower:"css/images/flowers.png",time:"10:20",address:"\u4e0a\u6d77",moodIcon:"css/images/f_1.png",mood:"\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u54e5",
moodPic:"css/images/mainImg.gif"},{avatar:"css/images/avatar.jpg",nickName:"\u7528\u6237#9",userPage:"#9",flower:"css/images/flowers.png",time:"10:20",address:"\u4e0a\u6d77",moodIcon:"css/images/f_1.png",mood:"\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u54e5",
moodPic:"css/images/mainImg.gif"},{avatar:"css/images/avatar.jpg",nickName:"\u7528\u6237#10",userPage:"#10",flower:"css/images/flowers.png",time:"10:20",address:"\u4e0a\u6d77",moodIcon:"css/images/f_1.png",mood:"\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u54e5",
moodPic:"css/images/mainImg.gif"},{avatar:"css/images/avatar.jpg",nickName:"\u7528\u6237#11",userPage:"#11",flower:"css/images/flowers.png",time:"10:20",address:"\u4e0a\u6d77",moodIcon:"css/images/f_1.png",mood:"\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u54e5",
moodPic:"css/images/mainImg.gif"},{avatar:"css/images/avatar.jpg",nickName:"\u7528\u6237#12",userPage:"#12",flower:"css/images/flowers.png",time:"10:20",address:"\u4e0a\u6d77",moodIcon:"css/images/f_1.png",mood:"\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u54e5",
moodPic:"css/images/mainImg.gif"},{avatar:"css/images/avatar.jpg",nickName:"\u7528\u6237#13",userPage:"#13",flower:"css/images/flowers.png",time:"10:20",address:"\u4e0a\u6d77",moodIcon:"css/images/f_1.png",mood:"\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u54e5",
moodPic:"css/images/mainImg.gif"},{avatar:"css/images/avatar.jpg",nickName:"\u7528\u6237#14",userPage:"#14",flower:"css/images/flowers.png",time:"10:20",address:"\u4e0a\u6d77",moodIcon:"css/images/f_1.png",mood:"\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u8001\u5927\u54e5",
moodPic:"css/images/mainImg.gif"}],myPhoto:[{href:"#1m",src:"images/female.png"},{href:"#2m",src:"images/female.png"},{href:"#3m",src:"images/female.png"},{href:"#4m",src:"images/female.png"},{href:"#5m",src:"images/female.png"},{href:"#6m",src:"images/female.png"},{href:"#7m",src:"images/female.png"},{href:"#8m",src:"images/female.png"},{href:"#9m",src:"images/female.png"},{href:"#10m",src:"images/female.png"},{href:"#11m",src:"images/female.png"},{href:"#12m",src:"images/female.png"},{href:"#13m",
src:"images/female.png"},{href:"#14m",src:"images/female.png"},{href:"#15m",src:"images/female.png"},{href:"#16m",src:"images/female.png"}],chatList:[{avatar:"css/images/avatar.jpg",userPage:"#1"},{avatar:"css/images/avatar.jpg",userPage:"#2"},{avatar:"css/images/avatar.jpg",userPage:"#3"},{avatar:"css/images/avatar.jpg",userPage:"#4"},{avatar:"css/images/avatar.jpg",userPage:"#5"}],chat:[{avatar:"css/images/avatar.jpg",id:"1",chatCon:"\u4f60\u597d\u554a#1"},{avatar:"css/images/avatar.jpg",id:"0",
chatCon:"\u4f60\u597d\u554a#2"},{avatar:"css/images/avatar.jpg",id:"1",chatCon:"\u4f60\u597d\u554a#3"},{avatar:"css/images/avatar.jpg",id:"1",chatCon:"\u4f60\u597d\u554a#4"},{avatar:"css/images/avatar.jpg",id:"0",chatCon:"\u4f60\u597d\u554a#5"}]},pageLists=["newGuest","likeMe","attract","myView","blackList","likePerson"],page;for(page in pageLists)fakeJsonData[pageLists[page]]=fakeJsonData.myPhoto;fakeJsonData.likeMood=fakeJsonData.mainList;fakeJsonData.myList=fakeJsonData.mainList;function initIScroll(a,b){function c(){setTimeout(function(){Feed.refresh()},1E3)}var f=a.offsetHeight,g=new iScroll(b,{useTransition:!0,topOffset:f,onRefresh:function(){if(DOM.hasClass(a,"loading"))DOM.dropClass(a,"loading"),$(".pullDownLabel",a).innerHTML="\u4e0b\u62c9\u5237\u65b0\u9875\u9762..."},onScrollMove:function(){if(this.y>5)DOM.addClass(a,"flip"),$(".pullDownLabel",a).innerHTML="\u91ca\u653e\u5237\u65b0\u9875\u9762...",this.minScrollY=0;else if(this.y<5&&DOM.hasClass(a,"flip"))DOM.dropClass(a,
"flip"),$(".pullDownLabel",a).innerHTML="\u4e0b\u62c9\u5237\u65b0\u9875\u9762...",this.minScrollY=-f},onScrollEnd:function(){if(DOM.hasClass(a,"flip"))DOM.dropClass(a,"flip"),DOM.addClass(a,"loading"),a.querySelector(".pullDownLabel").innerHTML="\u8f7d\u5165\u4e2d...",c(g)}});setTimeout(function(){$("#wrapper").style.left="0"},200);return g}
function initDockScroll(a,b,c){function f(){if(o>10)clearInterval(k),o=0;else{j=$$(a,$(c));len=j.length;var b=myScroll.y;if(len!=0)b+j[0].offsetTop>=0?fackDock.style.display="none":(fackDock.style.display="block",fackDock.style.width=j[0].offsetWidth+"px"),$.each(j,function(a,c){var f=c+1<len?j[c+1].offsetTop:1E6,g=f+b,k=a.offsetHeight;if(a.offsetTop+b<=0&&g>0&&(fackDock.innerHTML="",fackDock.appendChild(a.cloneNode(!0)),fackDock.style.top="0",g<k))fackDock.appendChild(j[c+1].cloneNode(!0)),fackDock.style.top=
b+f-k+"px"}),o++}}var g=$("#"+b);fackDock=DOM.create("div");DOM.addClass(fackDock,"fackDock");g.appendChild(fackDock);var j,o=0,k;myScroll=new iScroll(b,{useTransition:!0,onRefresh:function(){},onScrollStart:function(){},onScrollMove:function(){myScroll.y>=0?fackDock.style.display="none":(fackDock.style.display="block",f(),clearInterval(k),o=0,k=setInterval(f,300))},onScrollEnd:function(){}});setTimeout(function(){g.style.left="0"},200);return myScroll}
var actionSheet={show:function(a){isTouch?(a=this.actionObj[a],uexWindow.cbActionSheet=a[3],uexWindow.actionSheet(a[0],a[1],a[2])):toast("\u4e0d\u652f\u6301\u624b\u673a\u539f\u751f\u5f39\u51fa\u7a97",4)},actionObj:{search:["\u641c\u7d22","\u53d6\u6d88",["\u663e\u793a\u5168\u90e8","\u53ea\u663e\u793a\u7537","\u53ea\u663e\u793a\u5973","\u66f4\u6362\u5730\u533a"],function(a,b,c){toast(c,5)}],photo:["\u6dfb\u52a0\u7167\u7247","\u53d6\u6d88",["\u4ece\u76f8\u518c\u4e2d\u9009\u62e9","\u62cd\u7167"],function(a,
b,c){switch(c){case "0":var f,g="http://10.1.1.201/friend/v3/photo.php";/m.kxjy.com/.test(location.href)&&(g="http://m.kxjy.com/photo.php");var j=function(){uexXmlHttpMgr.onPostProgress=function(a,b){$("#mood").innerHTML+=b+"."};uexXmlHttpMgr.onData=function(a,b,c){toast(b);b==1?(toast(c,3),a=DOM.create("img"),a.src=c.replace("FILEID:",""),a.style.width="120px",a.style.height="120px",$(".showMoodPlus").appendChild(a)):toast("\u4e0a\u4f20\u51fa\u9519",3);uexXmlHttpMgr.close(2)};uexXmlHttpMgr.open(2,
"POST",g,"");uexXmlHttpMgr.setPostData(2,"0","upload","1");toast(Tools.getSid());uexXmlHttpMgr.setPostData(2,"0","sid",Tools.getSid());f&&uexXmlHttpMgr.setPostData(2,"1","image",f);uexXmlHttpMgr.send(2)};uexImageBrowser.cbPick=function(a,b,c){toast(c);f=c;j()};uexImageBrowser.pick();break;case "1":uexCamera.cbOpen=function(a,b,c){b==0&&(f=c)};uexCamera.open();break;case "2":$("#mood").focus()}}]}};
function openWindowS(a){!RegExp(a).test(location.href)&&$("#content")&&DOM.addClass($("#content"),"loading");var b=location.href,c=/\?.*$/.exec(b)[0],b=b.replace(c,""),c=c.split("&"),f=b.replace(/[^\/]\w*\.\w*$/,a);$.each(c,function(a){var b=/[^\w]sid=(\w*)/;b.test(a)&&(f=f+"?sid="+b.exec(a)[1])});location.href=f}function toast(a,b){isTouch?uexWindow.toast(0,5,a,!b?0:b*1E3):Tips.show(a,null,b*1E3)}
var Tips={hasTip:!1,container:"#content",tipH:0,timer:null,show:function(a,b,c){if(!Tips.hasTip)Tips.tipD=DOM.create("div"),b=(b=$(b||Tips.container))?b:BODY,b.appendChild(Tips.tipD),DOM.addClass(Tips.tipD,"tipsShow"),Tips.hasTip=!0,DOM.addEvent(Tips.tipD,CLICK_EVENT,function(){Tips.hide()});var f=Tips.tipD;f.innerHTML=a;f.style.display="block";Tips.tipH=f.offsetHeight;clearTimeout(Tips.timer);Tips.timer=null;setTimeout(function(){f.style.bottom="0px"},0);if(c)Tips.timer=setTimeout(function(){Tips.hide()},
c)},hide:function(){var a=Tips.tipD;a.style.bottom="-"+Tips.tipH+"px";setTimeout(function(){Tips.timer=null;a.style.display="none"},600)}};
Load.push(function(){$("#content")&&DOM.dropClass($("#content"),"loading");var a=$("#header");a&&$(".ui-icon-back",a)&&DOM.addEvent($(".ui-btn-left",a),CLICK_EVENT,function(){isTouch?(uexWindow.windowBack(5),DOM.dropClass($(".ui-page"),"loading")):history.back()});$(".hisFooter")&&DOM.addEvent($(".hisFooter"),CLICK_EVENT,function(a){$.each(a.getTargets(),function(a){if(a.tagName=="LI"){switch(a.className){case "ui-block-a":toast('<div class="myTitleAvatar fl ub-img1" style="background:url(http://v3pic1.kxjy.com/201205/31/6337211_13384593666gGi.jpg!135)"></div>\u559c\u6b22\u5979',
4);break;case "ui-block-b":toast("\u79c1\u4fe1\u5979",4);break;case "ui-block-c":toast("\u9001\u9c9c\u82b1",4);break;case "ui-block-d":toast("\u5c4f\u853d\u4ed6",4)}a=a.firstChild;if(a.type=="radio"&&a.checked)a.checked="";return!1}})})});var zy_tmpl_count=function(a){if(Object.prototype.toString.apply(a)==="[object Array]")return a.length;else{var b=0,c;for(c in a)b++;return b}},_f=function(a,b,c,f,g){if(b=b.match(/(first:|last:)(\"|\'*)([^\"\']*)(\"|\'*)/))if(b[1]==c)return b[2]=='"'||b[2]=="'"?b[3]:a[b[3]];else if(b[1]==f&&g>1)return""},t_f=function(a,b,c,f,g,j){return a.replace(/\$\{([^\}]*)\}/g,function(a,c){if(c.match(/index:/))return j;if(c.match(/cb:/)&&g)return g(b,c.match(/cb:(.*)/));if(q==0){var l=_f(b,c,"first:","last:",
f);if(l)return l}if(q==f-1&&(l=_f(b,c,"last:","first:",f)))return l;for(var l=c.split("."),t=b,x=l.length,q=0;q<x;q++)t=t[l[q]];return t})},zy_tmpl=function(a,b,c,f,g){var j="",o=0,k;for(k in b){g&&g(0,k,b[k]);var l=t_f(a,b[k],o,c,f);g&&g(1,l,b[k]);j+=l;o++}return j},zy_tmpl_s=function(a,b,c,f){return t_f(a,b,-1,-1,c,f)};(function(){var a=Math,b=/webkit/i.test(navigator.appVersion)?"webkit":/firefox/i.test(navigator.userAgent)?"Moz":/trident/i.test(navigator.userAgent)?"ms":"opera"in window?"O":"",c=/android/gi.test(navigator.appVersion),f=/iphone|ipad/gi.test(navigator.appVersion),g=/playbook/gi.test(navigator.appVersion),j=/hp-tablet/gi.test(navigator.appVersion),o="WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix,k="ontouchstart"in window&&!j,l=b+"Transform"in document.documentElement.style,t=f||g,x=function(){return window.requestAnimationFrame||
window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return setTimeout(a,1)}}(),q=window.cancelRequestAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout,y="onorientationchange"in window?"orientationchange":"resize",z=k?"touchstart":"mousedown",
u=k?"touchmove":"mousemove",v=k?"touchend":"mouseup",w=k?"touchcancel":"mouseup",A=b=="Moz"?"DOMMouseScroll":"mousewheel",r="translate"+(o?"3d(":"("),s=o?",0)":")",g=function(a,d){var h=this,B;h.wrapper=typeof a=="object"?a:document.getElementById(a);h.wrapper.style.overflow="hidden";h.scroller=h.wrapper.children[0];var C=$$("input,textarea",h.wrapper);$.each(C,function(a){DOM.addEvent(a,START_EVENT,function(a){a.event.stopPropagation()})});h.options={hScroll:!0,vScroll:!0,x:0,y:0,bounce:!0,bounceLock:!1,
momentum:!0,lockDirection:!0,useTransform:!0,useTransition:!1,topOffset:0,checkDOMChanges:!1,hScrollbar:!0,vScrollbar:!0,fixedScrollbar:c,hideScrollbar:f,fadeScrollbar:f&&o,scrollbarClass:"",zoom:!1,zoomMin:1,zoomMax:4,doubleTapZoom:2,wheelAction:"scroll",snap:!1,snapThreshold:1,onRefresh:null,onBeforeScrollStart:function(a){a.preventDefault()},onScrollStart:null,onBeforeScrollMove:null,onScrollMove:null,onBeforeScrollEnd:null,onScrollEnd:null,onTouchEnd:null,onDestroy:null,onZoomStart:null,onZoom:null,
onZoomEnd:null};for(B in d)h.options[B]=d[B];h.x=h.options.x;h.y=h.options.y;h.options.useTransform=l?h.options.useTransform:!1;h.options.hScrollbar=h.options.hScroll&&h.options.hScrollbar;h.options.vScrollbar=h.options.vScroll&&h.options.vScrollbar;h.options.zoom=h.options.useTransform&&h.options.zoom;h.options.useTransition=t&&h.options.useTransition;h.options.zoom&&c&&(r="translate(",s=")");h.scroller.style[b+"TransitionProperty"]=h.options.useTransform?"-"+b.toLowerCase()+"-transform":"top left";
h.scroller.style[b+"TransitionDuration"]="0";h.scroller.style[b+"TransformOrigin"]="0 0";h.options.useTransition&&(h.scroller.style[b+"TransitionTimingFunction"]="cubic-bezier(0.33,0.66,0.66,1)");h.options.useTransform?h.scroller.style[b+"Transform"]=r+h.x+"px,"+h.y+"px"+s:h.scroller.style.cssText+=";position:absolute;top:"+h.y+"px;left:"+h.x+"px";if(h.options.useTransition)h.options.fixedScrollbar=!0;h.refresh();h._bind(y,window);h._bind(z);k||(h._bind("mouseout",h.wrapper),h.options.wheelAction!=
"none"&&h._bind(A));if(h.options.checkDOMChanges)h.checkDOMTime=setInterval(function(){h._checkDOMChanges()},500)};g.prototype={enabled:!0,x:0,y:0,steps:[],scale:1,currPageX:0,currPageY:0,pagesX:[],pagesY:[],aniTime:null,wheelZoomCount:0,handleEvent:function(a){switch(a.type){case z:if(!k&&a.button!==0)break;this._start(a);break;case u:this._move(a);break;case v:case w:this._end(a);break;case y:this._resize();break;case A:this._wheel(a);break;case "mouseout":this._mouseout(a);break;case "webkitTransitionEnd":this._transitionEnd(a)}},
_checkDOMChanges:function(){!this.moved&&!this.zoomed&&!(this.animating||this.scrollerW==this.scroller.offsetWidth*this.scale&&this.scrollerH==this.scroller.offsetHeight*this.scale)&&this.refresh()},_scrollbar:function(i){var d=document,h;if(this[i+"Scrollbar"]){if(!this[i+"ScrollbarWrapper"]){h=d.createElement("div");this.options.scrollbarClass?h.className=this.options.scrollbarClass+i.toUpperCase():h.style.cssText="position:absolute;z-index:100;"+(i=="h"?"height:7px;bottom:1px;left:2px;right:"+
(this.vScrollbar?"7":"2")+"px":"width:7px;bottom:"+(this.hScrollbar?"7":"2")+"px;top:2px;right:1px");h.style.cssText+=";pointer-events:none;-"+b+"-transition-property:opacity;-"+b+"-transition-duration:"+(this.options.fadeScrollbar?"350ms":"0")+";overflow:hidden;opacity:"+(this.options.hideScrollbar?"0":"1");this.wrapper.appendChild(h);this[i+"ScrollbarWrapper"]=h;h=d.createElement("div");if(!this.options.scrollbarClass)h.style.cssText="position:absolute;z-index:100;background:rgba(0,0,0,0.3);border:1px solid rgba(255,255,255,0.3);-"+
b+"-background-clip:padding-box;-"+b+"-box-sizing:border-box;"+(i=="h"?"height:100%":"width:100%")+";-"+b+"-border-radius:3px;border-radius:3px";h.style.cssText+=";pointer-events:none;-"+b+"-transition-property:-"+b+"-transform;-"+b+"-transition-timing-function:cubic-bezier(0.33,0.66,0.66,1);-"+b+"-transition-duration:0;-"+b+"-transform:"+r+"0,0"+s;this.options.useTransition&&(h.style.cssText+=";-"+b+"-transition-timing-function:cubic-bezier(0.33,0.66,0.66,1)");this[i+"ScrollbarWrapper"].appendChild(h);
this[i+"ScrollbarIndicator"]=h}i=="h"?(this.hScrollbarSize=this.hScrollbarWrapper.clientWidth,this.hScrollbarIndicatorSize=a.max(this.hScrollbarSize*this.hScrollbarSize/this.scrollerW>>0,8),this.hScrollbarIndicator.style.width=this.hScrollbarIndicatorSize+"px",this.hScrollbarMaxScroll=this.hScrollbarSize-this.hScrollbarIndicatorSize,this.hScrollbarProp=this.hScrollbarMaxScroll/this.maxScrollX):(this.vScrollbarSize=this.vScrollbarWrapper.clientHeight,this.vScrollbarIndicatorSize=a.max(this.vScrollbarSize*
this.vScrollbarSize/this.scrollerH>>0,8),this.vScrollbarIndicator.style.height=this.vScrollbarIndicatorSize+"px",this.vScrollbarMaxScroll=this.vScrollbarSize-this.vScrollbarIndicatorSize,this.vScrollbarProp=this.vScrollbarMaxScroll/this.maxScrollY);this._scrollbarPos(i,!0)}else this[i+"ScrollbarWrapper"]&&(l&&(this[i+"ScrollbarIndicator"].style[b+"Transform"]=""),this[i+"ScrollbarWrapper"].parentNode.removeChild(this[i+"ScrollbarWrapper"]),this[i+"ScrollbarWrapper"]=null,this[i+"ScrollbarIndicator"]=
null)},_resize:function(){var a=this;setTimeout(function(){a.refresh()},c?200:0)},_pos:function(a,d){a=this.hScroll?a:0;d=this.vScroll?d:0;this.options.useTransform?this.scroller.style[b+"Transform"]=r+a+"px,"+d+"px"+s+" scale("+this.scale+")":(a>>=0,d>>=0,this.scroller.style.left=a+"px",this.scroller.style.top=d+"px");this.x=a;this.y=d;this._scrollbarPos("h");this._scrollbarPos("v")},_scrollbarPos:function(a,d){var h=a=="h"?this.x:this.y;if(this[a+"Scrollbar"])h*=this[a+"ScrollbarProp"],h<0?(this.options.fixedScrollbar||
(h=this[a+"ScrollbarIndicatorSize"]+(h*3>>0),h<8&&(h=8),this[a+"ScrollbarIndicator"].style[a=="h"?"width":"height"]=h+"px"),h=0):h>this[a+"ScrollbarMaxScroll"]&&(this.options.fixedScrollbar?h=this[a+"ScrollbarMaxScroll"]:(h=this[a+"ScrollbarIndicatorSize"]-((h-this[a+"ScrollbarMaxScroll"])*3>>0),h<8&&(h=8),this[a+"ScrollbarIndicator"].style[a=="h"?"width":"height"]=h+"px",h=this[a+"ScrollbarMaxScroll"]+(this[a+"ScrollbarIndicatorSize"]-h))),this[a+"ScrollbarWrapper"].style[b+"TransitionDelay"]="0",
this[a+"ScrollbarWrapper"].style.opacity=d&&this.options.hideScrollbar?"0":"1",this[a+"ScrollbarIndicator"].style[b+"Transform"]=r+(a=="h"?h+"px,0":"0,"+h+"px")+s},_start:function(i){var d=k?i.touches[0]:i,h,c;if(this.enabled){this.options.onBeforeScrollStart&&this.options.onBeforeScrollStart.call(this,i);(this.options.useTransition||this.options.zoom)&&this._transitionTime(0);this.zoomed=this.animating=this.moved=!1;this.dirY=this.dirX=this.absDistY=this.absDistX=this.distY=this.distX=0;if(this.options.zoom&&
k&&i.touches.length>1)c=a.abs(i.touches[0].pageX-i.touches[1].pageX),h=a.abs(i.touches[0].pageY-i.touches[1].pageY),this.touchesDistStart=a.sqrt(c*c+h*h),this.originX=a.abs(i.touches[0].pageX+i.touches[1].pageX-this.wrapperOffsetLeft*2)/2-this.x,this.originY=a.abs(i.touches[0].pageY+i.touches[1].pageY-this.wrapperOffsetTop*2)/2-this.y,this.options.onZoomStart&&this.options.onZoomStart.call(this,i);if(this.options.momentum&&(this.options.useTransform?(h=getComputedStyle(this.scroller,null)[b+"Transform"].replace(/[^0-9-.,]/g,
"").split(","),c=h[4]*1,h=h[5]*1):(c=getComputedStyle(this.scroller,null).left.replace(/[^0-9-]/g,"")*1,h=getComputedStyle(this.scroller,null).top.replace(/[^0-9-]/g,"")*1),c!=this.x||h!=this.y))this.options.useTransition?this._unbind("webkitTransitionEnd"):q(this.aniTime),this.steps=[],this._pos(c,h);this.absStartX=this.x;this.absStartY=this.y;this.startX=this.x;this.startY=this.y;this.pointX=d.pageX;this.pointY=d.pageY;this.startTime=i.timeStamp||Date.now();this.options.onScrollStart&&this.options.onScrollStart.call(this,
i);this._bind(u);this._bind(v);this._bind(w)}},_move:function(i){var d=k?i.touches[0]:i,h=d.pageX-this.pointX,c=d.pageY-this.pointY,f=this.x+h,g=this.y+c,m=i.timeStamp||Date.now();this.options.onBeforeScrollMove&&this.options.onBeforeScrollMove.call(this,i);if(this.options.zoom&&k&&i.touches.length>1)f=a.abs(i.touches[0].pageX-i.touches[1].pageX),g=a.abs(i.touches[0].pageY-i.touches[1].pageY),this.touchesDist=a.sqrt(f*f+g*g),this.zoomed=!0,d=1/this.touchesDistStart*this.touchesDist*this.scale,d<this.options.zoomMin?
d=0.5*this.options.zoomMin*Math.pow(2,d/this.options.zoomMin):d>this.options.zoomMax&&(d=2*this.options.zoomMax*Math.pow(0.5,this.options.zoomMax/d)),this.lastScale=d/this.scale,f=this.originX-this.originX*this.lastScale+this.x,g=this.originY-this.originY*this.lastScale+this.y,this.scroller.style[b+"Transform"]=r+f+"px,"+g+"px"+s+" scale("+d+")",this.options.onZoom&&this.options.onZoom.call(this,i);else{this.pointX=d.pageX;this.pointY=d.pageY;if(f>0||f<this.maxScrollX)f=this.options.bounce?this.x+
h/2:f>=0||this.maxScrollX>=0?0:this.maxScrollX;if(g>this.minScrollY||g<this.maxScrollY)g=this.options.bounce?this.y+c/2:g>=this.minScrollY||this.maxScrollY>=0?this.minScrollY:this.maxScrollY;this.distX+=h;this.distY+=c;this.absDistX=a.abs(this.distX);this.absDistY=a.abs(this.distY);if(!(this.absDistX<6&&this.absDistY<6)){if(this.options.lockDirection)if(this.absDistX>this.absDistY+5)g=this.y,c=0;else if(this.absDistY>this.absDistX+5)f=this.x,h=0;this.moved=!0;this._pos(f,g);this.dirX=h>0?-1:h<0?1:
0;this.dirY=c>0?-1:c<0?1:0;if(m-this.startTime>300)this.startTime=m,this.startX=this.x,this.startY=this.y;this.options.onScrollMove&&this.options.onScrollMove.call(this,i)}}},_end:function(i){if(!(k&&i.touches.length!=0)){var d=this,h=k?i.changedTouches[0]:i,c,f,g={dist:0,time:0},m={dist:0,time:0},j=(i.timeStamp||Date.now())-d.startTime,n=d.x,l=d.y;d._unbind(u);d._unbind(v);d._unbind(w);d.options.onBeforeScrollEnd&&d.options.onBeforeScrollEnd.call(d,i);if(d.zoomed)n=d.scale*d.lastScale,n=Math.max(d.options.zoomMin,
n),n=Math.min(d.options.zoomMax,n),d.lastScale=n/d.scale,d.scale=n,d.x=d.originX-d.originX*d.lastScale+d.x,d.y=d.originY-d.originY*d.lastScale+d.y,d.scroller.style[b+"TransitionDuration"]="200ms",d.scroller.style[b+"Transform"]=r+d.x+"px,"+d.y+"px"+s+" scale("+d.scale+")",d.zoomed=!1,d.refresh(),d.options.onZoomEnd&&d.options.onZoomEnd.call(d,i);else{if(d.moved){if(j<300&&d.options.momentum){g=n?d._momentum(n-d.startX,j,-d.x,d.scrollerW-d.wrapperW+d.x,d.options.bounce?d.wrapperW:0):g;m=l?d._momentum(l-
d.startY,j,-d.y,d.maxScrollY<0?d.scrollerH-d.wrapperH+d.y-d.minScrollY:0,d.options.bounce?d.wrapperH:0):m;n=d.x+g.dist;l=d.y+m.dist;if(d.x>0&&n>0||d.x<d.maxScrollX&&n<d.maxScrollX)g={dist:0,time:0};if(d.y>d.minScrollY&&l>d.minScrollY||d.y<d.maxScrollY&&l<d.maxScrollY)m={dist:0,time:0}}if(g.dist||m.dist){g=a.max(a.max(g.time,m.time),10);if(d.options.snap)m=n-d.absStartX,j=l-d.absStartY,a.abs(m)<d.options.snapThreshold&&a.abs(j)<d.options.snapThreshold?d.scrollTo(d.absStartX,d.absStartY,200):(m=d._snap(n,
l),n=m.x,l=m.y,g=a.max(m.time,g));d.scrollTo(n>>0,l>>0,g)}else d.options.snap?(m=n-d.absStartX,j=l-d.absStartY,a.abs(m)<d.options.snapThreshold&&a.abs(j)<d.options.snapThreshold?d.scrollTo(d.absStartX,d.absStartY,200):(m=d._snap(d.x,d.y),(m.x!=d.x||m.y!=d.y)&&d.scrollTo(m.x,m.y,m.time))):d._resetPos(200)}else{if(k)d.doubleTapTimer&&d.options.zoom?(clearTimeout(d.doubleTapTimer),d.doubleTapTimer=null,d.options.onZoomStart&&d.options.onZoomStart.call(d,i),d.zoom(d.pointX,d.pointY,d.scale==1?d.options.doubleTapZoom:
1),d.options.onZoomEnd&&setTimeout(function(){d.options.onZoomEnd.call(d,i)},200)):d.doubleTapTimer=setTimeout(function(){d.doubleTapTimer=null;for(c=h.target;c.nodeType!=1;)c=c.parentNode;if(c.tagName!="SELECT"&&c.tagName!="INPUT"&&c.tagName!="TEXTAREA")f=document.createEvent("MouseEvents"),f.initMouseEvent("click",!0,!0,i.view,1,h.screenX,h.screenY,h.clientX,h.clientY,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,0,null),f._fake=!0,c.dispatchEvent(f)},d.options.zoom?250:0);d._resetPos(200)}d.options.onTouchEnd&&
d.options.onTouchEnd.call(d,i)}}},_resetPos:function(a){var d=this.x>=0?0:this.x<this.maxScrollX?this.maxScrollX:this.x,h=this.y>=this.minScrollY||this.maxScrollY>0?this.minScrollY:this.y<this.maxScrollY?this.maxScrollY:this.y;if(d==this.x&&h==this.y){if(this.moved)this.moved=!1,this.options.onScrollEnd&&this.options.onScrollEnd.call(this);if(this.hScrollbar&&this.options.hideScrollbar)b=="webkit"&&(this.hScrollbarWrapper.style[b+"TransitionDelay"]="300ms"),this.hScrollbarWrapper.style.opacity="0";
if(this.vScrollbar&&this.options.hideScrollbar)b=="webkit"&&(this.vScrollbarWrapper.style[b+"TransitionDelay"]="300ms"),this.vScrollbarWrapper.style.opacity="0"}else this.scrollTo(d,h,a||0)},_wheel:function(a){var d=this,b,c;if("wheelDeltaX"in a)b=a.wheelDeltaX/12,c=a.wheelDeltaY/12;else if("wheelDelta"in a)b=c=a.wheelDelta/12;else if("detail"in a)b=c=-a.detail*3;else return;if(d.options.wheelAction=="zoom"){c=d.scale*Math.pow(2,1/3*(c?c/Math.abs(c):0));if(c<d.options.zoomMin)c=d.options.zoomMin;
if(c>d.options.zoomMax)c=d.options.zoomMax;c!=d.scale&&(!d.wheelZoomCount&&d.options.onZoomStart&&d.options.onZoomStart.call(d,a),d.wheelZoomCount++,d.zoom(a.pageX,a.pageY,c,400),setTimeout(function(){d.wheelZoomCount--;!d.wheelZoomCount&&d.options.onZoomEnd&&d.options.onZoomEnd.call(d,a)},400))}else{b=d.x+b;c=d.y+c;if(b>0)b=0;else if(b<d.maxScrollX)b=d.maxScrollX;if(c>d.minScrollY)c=d.minScrollY;else if(c<d.maxScrollY)c=d.maxScrollY;d.maxScrollY<0&&d.scrollTo(b,c,0)}},_mouseout:function(a){var d=
a.relatedTarget;if(d)for(;d=d.parentNode;)if(d==this.wrapper)return;this._end(a)},_transitionEnd:function(a){a.target==this.scroller&&(this._unbind("webkitTransitionEnd"),this._startAni())},_startAni:function(){var b=this,d=b.x,c=b.y,f=Date.now(),g,j,m;if(!b.animating)if(b.steps.length){g=b.steps.shift();if(g.x==d&&g.y==c)g.time=0;b.animating=!0;b.moved=!0;b.options.useTransition?(b._transitionTime(g.time),b._pos(g.x,g.y),b.animating=!1,g.time?b._bind("webkitTransitionEnd"):b._resetPos(0)):(m=function(){var k=
Date.now();if(k>=f+g.time)b._pos(g.x,g.y),b.animating=!1,b.options.onAnimationEnd&&b.options.onAnimationEnd.call(b),b._startAni();else if(k=(k-f)/g.time-1,j=a.sqrt(1-k*k),k=(g.x-d)*j+d,b._pos(k,(g.y-c)*j+c),b.animating)b.aniTime=x(m)},m())}else b._resetPos(400)},_transitionTime:function(a){a+="ms";this.scroller.style[b+"TransitionDuration"]=a;this.hScrollbar&&(this.hScrollbarIndicator.style[b+"TransitionDuration"]=a);this.vScrollbar&&(this.vScrollbarIndicator.style[b+"TransitionDuration"]=a)},_momentum:function(b,
d,c,f,g){var d=a.abs(b)/d,j=d*d/0.0012,k=0,k=0;b>0&&j>c?(c+=g/(6/(j/d*6.0E-4)),d=d*c/j,j=c):b<0&&j>f&&(f+=g/(6/(j/d*6.0E-4)),d=d*f/j,j=f);j*=b<0?-1:1;return{dist:j,time:d/6.0E-4>>0}},_offset:function(a){for(var b=-a.offsetLeft,c=-a.offsetTop;a=a.offsetParent;)b-=a.offsetLeft,c-=a.offsetTop;a!=this.wrapper&&(b*=this.scale,c*=this.scale);return{left:b,top:c}},_snap:function(b,d){var c,f,g;g=this.pagesX.length-1;c=0;for(f=this.pagesX.length;c<f;c++)if(b>=this.pagesX[c]){g=c;break}g==this.currPageX&&
g>0&&this.dirX<0&&g--;b=this.pagesX[g];f=(f=a.abs(b-this.pagesX[this.currPageX]))?a.abs(this.x-b)/f*500:0;this.currPageX=g;g=this.pagesY.length-1;for(c=0;c<g;c++)if(d>=this.pagesY[c]){g=c;break}g==this.currPageY&&g>0&&this.dirY<0&&g--;d=this.pagesY[g];c=(c=a.abs(d-this.pagesY[this.currPageY]))?a.abs(this.y-d)/c*500:0;this.currPageY=g;g=a.max(f,c)>>0;return{x:b,y:d,time:g||200}},_bind:function(a,b,c){(b||this.scroller).addEventListener(a,this,!!c)},_unbind:function(a,b,c){(b||this.scroller).removeEventListener(a,
this,!!c)},destroy:function(){this.scroller.style[b+"Transform"]="";this.vScrollbar=this.hScrollbar=!1;this._scrollbar("h");this._scrollbar("v");this._unbind(y,window);this._unbind(z);this._unbind(u);this._unbind(v);this._unbind(w);this.options.hasTouch||(this._unbind("mouseout",this.wrapper),this._unbind(A));this.options.useTransition&&this._unbind("webkitTransitionEnd");this.options.checkDOMChanges&&clearInterval(this.checkDOMTime);this.options.onDestroy&&this.options.onDestroy.call(this)},refresh:function(){var a,
d,c,f=0;d=0;if(this.scale<this.options.zoomMin)this.scale=this.options.zoomMin;this.wrapperW=this.wrapper.clientWidth||1;this.wrapperH=this.wrapper.clientHeight||1;this.minScrollY=-this.options.topOffset||0;this.scrollerW=this.scroller.offsetWidth*this.scale>>0;this.scrollerH=(this.scroller.offsetHeight+this.minScrollY)*this.scale>>0;this.maxScrollX=this.wrapperW-this.scrollerW;this.maxScrollY=this.wrapperH-this.scrollerH+this.minScrollY;this.dirY=this.dirX=0;this.options.onRefresh&&this.options.onRefresh.call(this);
this.hScroll=this.options.hScroll&&this.maxScrollX<0;this.vScroll=this.options.vScroll&&(!this.options.bounceLock&&!this.hScroll||this.scrollerH>this.wrapperH);this.hScrollbar=this.hScroll&&this.options.hScrollbar;this.vScrollbar=this.vScroll&&this.options.vScrollbar&&this.scrollerH>this.wrapperH;a=this._offset(this.wrapper);this.wrapperOffsetLeft=-a.left;this.wrapperOffsetTop=-a.top;if(typeof this.options.snap=="string"){this.pagesX=[];this.pagesY=[];c=this.scroller.querySelectorAll(this.options.snap);
a=0;for(d=c.length;a<d;a++)f=this._offset(c[a]),f.left+=this.wrapperOffsetLeft,f.top+=this.wrapperOffsetTop,this.pagesX[a]=f.left<this.maxScrollX?this.maxScrollX:f.left*this.scale,this.pagesY[a]=f.top<this.maxScrollY?this.maxScrollY:f.top*this.scale}else if(this.options.snap){for(this.pagesX=[];f>=this.maxScrollX;)this.pagesX[d]=f,f-=this.wrapperW,d++;this.maxScrollX%this.wrapperW&&(this.pagesX[this.pagesX.length]=this.maxScrollX-this.pagesX[this.pagesX.length-1]+this.pagesX[this.pagesX.length-1]);
d=f=0;for(this.pagesY=[];f>=this.maxScrollY;)this.pagesY[d]=f,f-=this.wrapperH,d++;this.maxScrollY%this.wrapperH&&(this.pagesY[this.pagesY.length]=this.maxScrollY-this.pagesY[this.pagesY.length-1]+this.pagesY[this.pagesY.length-1])}this._scrollbar("h");this._scrollbar("v");this.zoomed||(this.scroller.style[b+"TransitionDuration"]="0",this._resetPos(200))},scrollTo:function(a,b,c,f){var g=a;this.stop();g.length||(g=[{x:a,y:b,time:c,relative:f}]);a=0;for(b=g.length;a<b;a++){if(g[a].relative)g[a].x=
this.x-g[a].x,g[a].y=this.y-g[a].y;this.steps.push({x:g[a].x,y:g[a].y,time:g[a].time||0})}this._startAni()},scrollToElement:function(b,d){var c;if(b=b.nodeType?b:this.scroller.querySelector(b))c=this._offset(b),c.left+=this.wrapperOffsetLeft,c.top+=this.wrapperOffsetTop,c.left=c.left>0?0:c.left<this.maxScrollX?this.maxScrollX:c.left,c.top=c.top>this.minScrollY?this.minScrollY:c.top<this.maxScrollY?this.maxScrollY:c.top,d=d===void 0?a.max(a.abs(c.left)*2,a.abs(c.top)*2):d,this.scrollTo(c.left,c.top,
d)},scrollToPage:function(a,b,c){c=c===void 0?400:c;this.options.onScrollStart&&this.options.onScrollStart.call(this);if(this.options.snap)a=a=="next"?this.currPageX+1:a=="prev"?this.currPageX-1:a,b=b=="next"?this.currPageY+1:b=="prev"?this.currPageY-1:b,a=a<0?0:a>this.pagesX.length-1?this.pagesX.length-1:a,b=b<0?0:b>this.pagesY.length-1?this.pagesY.length-1:b,this.currPageX=a,this.currPageY=b,a=this.pagesX[a],b=this.pagesY[b];else{a*=-this.wrapperW;b*=-this.wrapperH;if(a<this.maxScrollX)a=this.maxScrollX;
if(b<this.maxScrollY)b=this.maxScrollY}this.scrollTo(a,b,c)},disable:function(){this.stop();this._resetPos(0);this.enabled=!1;this._unbind(u);this._unbind(v);this._unbind(w)},enable:function(){this.enabled=!0},stop:function(){this.options.useTransition?this._unbind("webkitTransitionEnd"):q(this.aniTime);this.steps=[];this.animating=this.moved=!1},zoom:function(a,c,f,g){var j=f/this.scale;if(this.options.useTransform)this.zoomed=!0,g=g===void 0?200:g,a=a-this.wrapperOffsetLeft-this.x,c=c-this.wrapperOffsetTop-
this.y,this.x=a-a*j+this.x,this.y=c-c*j+this.y,this.scale=f,this.refresh(),this.x=this.x>0?0:this.x<this.maxScrollX?this.maxScrollX:this.x,this.y=this.y>this.minScrollY?this.minScrollY:this.y<this.maxScrollY?this.maxScrollY:this.y,this.scroller.style[b+"TransitionDuration"]=g+"ms",this.scroller.style[b+"Transform"]=r+this.x+"px,"+this.y+"px"+s+" scale("+f+")",this.zoomed=!1},isReady:function(){return!this.moved&&!this.zoomed&&!this.animating}};typeof exports!=="undefined"?exports.iScroll=g:window.iScroll=
g})();
